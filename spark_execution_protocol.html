<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spark Protocol: End-to-End Execution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <!-- 
    THEME: "Mission Control"
    - Dark Mode: Professional, technical, high-contrast.
    - Interaction: Step-by-step linear progression.
    - Font: JetBrains Mono for data, Inter for text.
    -->

    <style>
        body { background-color: #0B0F19; color: #E2E8F0; font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0B0F19; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        /* Timeline Connector Line */
        .step-line {
            position: absolute;
            left: 24px;
            top: 40px;
            bottom: -24px;
            width: 2px;
            background: #334155;
            z-index: 0;
        }
        .last-step .step-line { display: none; }

        /* Cards */
        .step-card {
            transition: all 0.3s ease;
            border: 1px solid #1E293B;
        }
        .step-card:hover {
            border-color: #3B82F6;
            background-color: #151E2E;
            transform: translateX(4px);
            cursor: pointer;
        }
        .step-card.active {
            border-color: #F97316; /* Orange for active */
            background-color: #1E293B;
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.1);
        }

        /* Toggles */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #F97316;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #F97316;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-6 flex-shrink-0 z-20">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-orange-500 rounded flex items-center justify-center font-bold text-black text-xs">SPK</div>
            <div>
                <h1 class="font-bold text-white tracking-tight">EXECUTION PROTOCOL</h1>
                <p class="text-[10px] text-slate-400 mono uppercase">v2.0 | Global Settlement Layer</p>
            </div>
        </div>
        
        <!-- Scenario Switcher -->
        <div class="flex items-center gap-4 bg-slate-800 p-1.5 rounded-lg border border-slate-700">
            <span class="text-xs font-bold text-slate-400 px-2">OPERATING MODE:</span>
            <button onclick="setMode('crowd')" id="btn-crowd" class="px-4 py-1.5 rounded text-xs font-bold transition-colors bg-orange-600 text-white">
                SCENARIO A: Crowdfund (Escrow)
            </button>
            <button onclick="setMode('inventory')" id="btn-inventory" class="px-4 py-1.5 rounded text-xs font-bold transition-colors text-slate-400 hover:text-white">
                SCENARIO B: Inventory (Direct)
            </button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <!-- Left Panel: The Step-by-Step Timeline -->
        <aside class="w-1/3 bg-[#0B0F19] border-r border-slate-800 overflow-y-auto p-6 relative">
            <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-6 sticky top-0 bg-[#0B0F19] py-2 z-10">Sequence of Events</h2>
            <div id="steps-container" class="space-y-6 relative">
                <!-- Steps injected via JS -->
            </div>
        </aside>

        <!-- Right Panel: Deep Dive Details -->
        <main class="w-2/3 bg-slate-900 p-8 overflow-y-auto">
            <div id="detail-view" class="max-w-4xl mx-auto">
                <!-- Default Landing State -->
                <div class="flex flex-col items-center justify-center h-full text-center pt-20 opacity-50">
                    <div class="w-16 h-16 border-2 border-slate-700 rounded-full flex items-center justify-center mb-4 text-2xl">ðŸ‘‡</div>
                    <h3 class="text-xl font-bold text-white">Select a Step</h3>
                    <p class="text-slate-400">Click on the timeline to view the legal, technical, and banking requirements.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Javascript Data & Logic -->
    <script>
        // --- DATA: The Playbook ---
        const protocols = {
            crowd: [
                {
                    id: "c1",
                    title: "Entity & License Prep",
                    desc: "Establishing the Legal Wrapper before taking a single dollar.",
                    status: "Prerequisite",
                    icon: "ðŸ›ï¸",
                    details: {
                        objective: "Ensure we can legally accept funds without being an unregistered broker.",
                        legal_action: "Incorporate Cayman SPC (Segregated Portfolio Company). Create 'Portfolio A' specifically for SpaceX Series X.",
                        tools: ["Maples Group (Counsel)", "Britannia Forge (UK Admin)", "CIMA Registration"],
                        documents: ["Private Placement Memorandum (PPM)", "Subscription Agreement Template"],
                        risk: "Critical: Do not advertise to US retail investors. Strict Reg S / Reg D 506(c) only."
                    }
                },
                {
                    id: "c2",
                    title: "Conditional Commitments",
                    desc: "Collecting 'Soft Circles' & Deposits from users.",
                    status: "Capital Formation",
                    icon: "ðŸ’°",
                    details: {
                        objective: "Gather the $5M needed to buy the block without holding the asset yet.",
                        legal_action: "Users sign a 'Conditional Subscription Agreement'. Money moves to a Qualified Custodian or USDC Smart Contract Escrow.",
                        tools: ["Circle (USDC Rails)", "Fireblocks (Wallet)", "SumSub (KYC/AML)"],
                        documents: ["Escrow Agreement", "Proof of Deposit Receipt (PDF)"],
                        risk: "If the deal fails (ROFR triggered), you must have a mechanism to refund 100% of gas/fees."
                    }
                },
                {
                    id: "c3",
                    title: "Sourcing & Execution",
                    desc: "Buying the SpaceX shares from an employee/fund.",
                    status: "Acquisition",
                    icon: "ðŸ¤",
                    details: {
                        objective: "Execute the 'Block Trade' with the seller.",
                        legal_action: "Spark Cayman SPC signs Stock Transfer Agreement with Seller. Seller notifies SpaceX.",
                        tools: ["Forge Global / Hiive (Marketplace)", "Assure / Angellist (SPV Admin)"],
                        documents: ["Stock Transfer Agreement", "ROFR Notice to Company"],
                        risk: "ROFR Risk: SpaceX has 30 days to say 'No' and buy the shares themselves. If this happens, goto Refund Protocol."
                    }
                },
                {
                    id: "c4",
                    title: "Settlement & Proof",
                    desc: "Closing the trade and proving ownership.",
                    status: "Settlement",
                    icon: "ðŸ“œ",
                    details: {
                        objective: "Get the specific share certificate name changed to 'Spark Asset SPC'.",
                        legal_action: "SpaceX updates their Cap Table (Carta/Computershare). Sends new Certificate to Spark.",
                        tools: ["Carta (Cap Table Mgmt)", "Box (Secure Doc Storage)"],
                        documents: ["Share Certificate", "Officer Certificate of Ownership"],
                        risk: "This is your 'Proof of Reserve'. You must redact sensitive info and upload the hash to the dashboard."
                    }
                },
                {
                    id: "c5",
                    title: "Token Minting & Distribution",
                    desc: "Converting the legal right into a digital token.",
                    status: "Tokenization",
                    icon: "â›“ï¸",
                    details: {
                        objective: "Issue ERC-3643 tokens 1:1 backed by the economic rights of the shares.",
                        legal_action: "Board Resolution authorizing issuance. Smart Contract deploys.",
                        tools: ["Polygon/Avalanche (Chain)", "T-REX Standard (ERC-3643)", "Hardhat"],
                        documents: ["Token Purchase Agreement (Final)", "Smart Contract Audit Report"],
                        risk: "Ensure tokens are 'Frozen' by default and can only move to Whitelisted wallets (KYC checked)."
                    }
                },
                {
                    id: "c6",
                    title: "Secondary Trading",
                    desc: "Opening the 'Walled Garden' liquidity pool.",
                    status: "Live Ops",
                    icon: "ðŸ“ˆ",
                    details: {
                        objective: "Allow users to trade tokens P2P.",
                        legal_action: "Operate as a 'Bulletin Board' (Not an Exchange) under Reg S.",
                        tools: ["Internal Matching Engine (Off-chain)", "Atomic Swap Contracts (On-chain)"],
                        documents: ["Risk Disclosure Statement"],
                        risk: "Strict geofencing. US IPs cannot access the trading UI."
                    }
                }
            ],
            inventory: [
                {
                    id: "i1",
                    title: "Balance Sheet Acquisition",
                    desc: "Spark buys the shares using its own capital first.",
                    status: "Prerequisite",
                    icon: "ðŸ’¼",
                    details: {
                        objective: "Secure the asset immediately to offer 'Instant Settlement' to users.",
                        legal_action: "Spark Cayman SPC buys $2M of OpenAI shares using company treasury.",
                        tools: ["Corporate Treasury", "Prime Broker"],
                        documents: ["Share Certificate (Already Owned)"],
                        risk: "Capital Risk. If nobody buys the tokens, Spark is stuck holding the shares."
                    }
                },
                {
                    id: "i2",
                    title: "Tokenization Setup",
                    desc: "Pre-minting the inventory.",
                    status: "Tech Prep",
                    icon: "âš™ï¸",
                    details: {
                        objective: "Mint 20,000 tokens representing the $2M stake. Hold in Treasury Wallet.",
                        legal_action: "Draft 'Token Offering Circular'.",
                        tools: ["Fireblocks (Treasury Vault)"],
                        documents: ["Whitepaper / Offering Circ."],
                        risk: "Security. These tokens are now worth $2M. Multi-sig custody is mandatory."
                    }
                },
                {
                    id: "i3",
                    title: "Direct Sales (Primary Market)",
                    desc: "Selling tokens to users (Instant Delivery).",
                    status: "Sales",
                    icon: "ðŸ›’",
                    details: {
                        objective: "User pays USDC -> User gets Token immediately.",
                        legal_action: "Sale of Digital Asset Agreement.",
                        tools: ["Smart Contract Swap", "Stripe Identity / SumSub"],
                        documents: ["Trade Confirmation Receipt"],
                        risk: "Classification. Ensure this looks like a sale of a derivative, not a distribution of equity."
                    }
                },
                {
                    id: "i4",
                    title: "Secondary Trading",
                    desc: "Market Making.",
                    status: "Live Ops",
                    icon: "ðŸ“ˆ",
                    details: {
                        objective: "Provide exit liquidity.",
                        legal_action: "Market Making Agreement.",
                        tools: ["Automated Market Maker (AMM) Logic"],
                        documents: ["Terms of Service"],
                        risk: "Slippage and liquidity crunch."
                    }
                }
            ]
        };

        let currentMode = 'crowd';

        // --- RENDER LOGIC ---
        
        function setMode(mode) {
            currentMode = mode;
            
            // UI Toggle State
            document.getElementById('btn-crowd').className = mode === 'crowd' 
                ? "px-4 py-1.5 rounded text-xs font-bold transition-colors bg-orange-600 text-white"
                : "px-4 py-1.5 rounded text-xs font-bold transition-colors text-slate-400 hover:text-white";
                
            document.getElementById('btn-inventory').className = mode === 'inventory'
                ? "px-4 py-1.5 rounded text-xs font-bold transition-colors bg-blue-600 text-white"
                : "px-4 py-1.5 rounded text-xs font-bold transition-colors text-slate-400 hover:text-white";

            renderSteps();
            // Clear detail view
            document.getElementById('detail-view').innerHTML = `
                <div class="flex flex-col items-center justify-center h-full text-center pt-20 opacity-50">
                    <div class="w-16 h-16 border-2 border-slate-700 rounded-full flex items-center justify-center mb-4 text-2xl">ðŸ‘‡</div>
                    <h3 class="text-xl font-bold text-white">Mode Switched: ${mode.toUpperCase()}</h3>
                    <p class="text-slate-400">Select a step to view the new protocol details.</p>
                </div>
            `;
        }

        function renderSteps() {
            const container = document.getElementById('steps-container');
            const steps = protocols[currentMode];
            
            container.innerHTML = steps.map((step, index) => `
                <div onclick="showDetail('${step.id}')" class="step-card relative bg-[#0F172A] p-4 rounded-lg z-10 ${index === steps.length - 1 ? 'last-step' : ''}">
                    <div class="step-line"></div>
                    <div class="flex items-start gap-4 relative z-10">
                        <div class="w-12 h-12 rounded bg-slate-800 border border-slate-700 flex items-center justify-center text-2xl flex-shrink-0">
                            ${step.icon}
                        </div>
                        <div>
                            <div class="text-[10px] font-bold text-slate-500 uppercase mb-1 tracking-wide">${step.status}</div>
                            <h3 class="text-sm font-bold text-white mb-1">${step.title}</h3>
                            <p class="text-xs text-slate-400 leading-relaxed">${step.desc}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showDetail(id) {
            const step = protocols[currentMode].find(s => s.id === id);
            const detailContainer = document.getElementById('detail-view');
            
            // Highlight active card
            document.querySelectorAll('.step-card').forEach(c => c.classList.remove('active'));
            // Find the clicked card (simple hack for this demo)
            // In production, pass 'this' or index
            
            // Render Detail
            detailContainer.innerHTML = `
                <div class="animate-fade-in">
                    <div class="flex items-center gap-4 mb-8 border-b border-slate-800 pb-6">
                        <div class="w-16 h-16 bg-slate-800 rounded-lg flex items-center justify-center text-4xl">
                            ${step.icon}
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-1">${step.title}</h2>
                            <p class="text-slate-400 font-mono text-sm">${step.details.objective}</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-[#0B0F19] p-6 rounded-lg border border-slate-800">
                            <h4 class="text-xs font-bold text-orange-500 uppercase mb-4">Legal & Compliance Action</h4>
                            <p class="text-sm text-slate-300 leading-relaxed">${step.details.legal_action}</p>
                        </div>
                        <div class="bg-[#0B0F19] p-6 rounded-lg border border-slate-800">
                            <h4 class="text-xs font-bold text-red-500 uppercase mb-4">Critical Risk Factor</h4>
                            <p class="text-sm text-slate-300 leading-relaxed">${step.details.risk}</p>
                        </div>
                    </div>

                    <h4 class="text-xs font-bold text-slate-500 uppercase mb-4">Required Tool Stack</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-8">
                        ${step.details.tools.map(tool => `
                            <div class="bg-slate-800 px-3 py-2 rounded text-xs text-slate-300 border border-slate-700 flex items-center gap-2">
                                <span class="w-2 h-2 bg-blue-500 rounded-full"></span> ${tool}
                            </div>
                        `).join('')}
                    </div>

                    <h4 class="text-xs font-bold text-slate-500 uppercase mb-4">Documents Generated (Proof)</h4>
                    <div class="space-y-2">
                        ${step.details.documents.map(doc => `
                            <div class="flex items-center justify-between bg-slate-800/50 p-3 rounded border border-slate-700">
                                <div class="flex items-center gap-3">
                                    <span class="text-xl">ðŸ“„</span>
                                    <span class="text-sm text-slate-300 font-mono">${doc}</span>
                                </div>
                                <span class="text-[10px] bg-slate-900 px-2 py-1 rounded text-slate-500">PDF/JSON</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            renderSteps();
        });
    </script>
</body>
</html>
